{
  "$parameters": {
    "NAME": { "required": true },
    "TAG": { "required": true},
    "PUBLIC": { "required": true },
    "NUM_INSTANCES": { "default": 1 },
    "INSTANCE_TYPE": { "default": "t2.micro" }
  },

  "type": "service",
  "name": "${NAME}",

  "components": [
    {
      "name": "service",
      "ports": [
        {
          "name": "tcp",
          "port": 6379,
          "protocol": "TCP",
          "external_access": {
            "public": "${PUBLIC}"
          }
        }
      ],
      "build": {
        "docker_image": {
          "registry": "registry.hub.docker.com",
          "repository": "library/redis",
          "tag": "${TAG}"
        }
      },
      "exec": {
        "command": [
          "redis-server"
        ]
      },
      "health_check": {
        "exec": {
          "command": ["redis-cli", "PING"]
        }
      }
    }
  ],
  "resources": {
    "num_instances": "${NUM_INSTANCES}",
    "instance_type": "${INSTANCE_TYPE}"
  }
}
